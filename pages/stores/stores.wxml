<!--pages/stores/stores.wxml - é—¨åº—ç®¡ç†é¡µé¢-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">é—¨åº—ç®¡ç†</view>
    <view class="header-subtitle">ç®¡ç†åˆä½œç»´ä¿®é—¨åº—</view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-bar">
    <view class="search-row">
      <picker
        mode="selector"
        range="{{statusOptions}}"
        range-key="label"
        value="{{statusIndex}}"
        bindchange="onStatusChange"
      >
        <view class="filter-picker">
          <text>{{statusOptions[statusIndex].label}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>
    <view class="search-row">
      <input
        class="search-input"
        placeholder="æœç´¢é—¨åº—åç§°"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- é—¨åº—åˆ—è¡¨ -->
  <view class="list-container">
    <view
      class="store-card"
      wx:for="{{stores}}"
      wx:key="_id"
    >
      <!-- é—¨åº—åŸºæœ¬ä¿¡æ¯ -->
      <view class="store-header">
        <view class="store-name">{{item.name}}</view>
        <view class="store-status status-{{item.status}}">
          {{item.status === 'pending_audit' ? 'å¾…å®¡æ ¸' : item.status === 'normal' ? 'æ­£å¸¸' : 'å·²åœç”¨'}}
        </view>
      </view>

      <!-- é—¨åº—è¯¦ç»†ä¿¡æ¯ -->
      <view class="store-info">
        <view class="info-row">
          <text class="label">è”ç³»äººï¼š</text>
          <text class="value">{{item.contact.name}}</text>
        </view>
        <view class="info-row">
          <text class="label">è”ç³»ç”µè¯ï¼š</text>
          <text class="value">{{item.contact.phone}}</text>
        </view>
        <view class="info-row">
          <text class="label">è¥ä¸šæ—¶é—´ï¼š</text>
          <text class="value">{{item.businessHours}}</text>
        </view>
        <view class="info-row">
          <text class="label">æœåŠ¡èŒƒå›´ï¼š</text>
          <text class="value">{{item.serviceRange}}km</text>
        </view>
        <view class="info-row">
          <text class="label">åœ°å€ï¼š</text>
          <text class="value">{{item.address.city}}{{item.address.district}}{{item.address.detail}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-row">
        <button
          class="action-btn primary"
          data-id="{{item._id}}"
          bindtap="onViewDetail"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>

        <button
          wx:if="{{item.status === 'pending_audit'}}"
          class="action-btn success"
          data-id="{{item._id}}"
          bindtap="onApprove"
        >
          å®¡æ ¸é€šè¿‡
        </button>

        <button
          wx:if="{{item.status === 'normal'}}"
          class="action-btn warning"
          data-id="{{item._id}}"
          data-status="suspended"
          bindtap="onUpdateStatus"
        >
          åœç”¨
        </button>

        <button
          wx:if="{{item.status === 'suspended'}}"
          class="action-btn success"
          data-id="{{item._id}}"
          data-status="normal"
          bindtap="onUpdateStatus"
        >
          å¯ç”¨
        </button>

        <button
          class="action-btn danger"
          data-id="{{item._id}}"
          bindtap="onDelete"
        >
          åˆ é™¤
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{stores.length === 0 && !loading}}">
      <text class="empty-icon">ğŸª</text>
      <text class="empty-text">æš‚æ— é—¨åº—æ•°æ®</text>
    </view>
  </view>
</view>
