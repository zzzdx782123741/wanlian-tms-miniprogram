<!--pages/users/users.wxml - ç”¨æˆ·ç®¡ç†é¡µé¢-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">ç”¨æˆ·ç®¡ç†</view>
    <view class="header-subtitle">ç®¡ç†ç³»ç»Ÿç”¨æˆ·æƒé™</view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-bar">
    <view class="search-row">
      <picker
        mode="selector"
        range="{{roleOptions}}"
        range-key="label"
        value="{{roleIndex}}"
        bindchange="onRoleChange"
      >
        <view class="filter-picker half">
          <text>{{roleOptions[roleIndex].label}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>

      <picker
        mode="selector"
        range="{{statusOptions}}"
        range-key="label"
        value="{{statusIndex}}"
        bindchange="onStatusChange"
      >
        <view class="filter-picker half">
          <text>{{statusOptions[statusIndex].label}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>
    <view class="search-row">
      <input
        class="search-input"
        placeholder="æœç´¢ç”¨æˆ·æ˜µç§°æˆ–æ‰‹æœºå·"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- ç”¨æˆ·åˆ—è¡¨ -->
  <view class="list-container">
    <view
      class="user-card"
      wx:for="{{users}}"
      wx:key="_id"
    >
      <!-- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ -->
      <view class="user-header">
        <view class="user-info">
          <image class="avatar" src="{{item.avatar || '/images/icons/avatar.png'}}" mode="aspectFill"/>
          <view class="user-details">
            <view class="user-name">{{item.nickname || item.name || 'æœªè®¾ç½®æ˜µç§°'}}</view>
            <view class="user-phone">{{item.phone || 'æœªç»‘å®šæ‰‹æœº'}}</view>
          </view>
        </view>
        <view class="user-status status-{{item.role ? item.role.status : ''}}">
          {{item.role && item.role.status === 'normal' ? 'æ­£å¸¸' : item.role && item.role.status === 'pending_audit' ? 'å¾…å®¡æ ¸' : 'å·²åœç”¨'}}
        </view>
      </view>

      <!-- ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ -->
      <view class="user-meta">
        <view class="meta-item">
          <text class="meta-label">è§’è‰²</text>
          <text class="meta-value role-{{item.role ? item.role.type : ''}}">
            {{item.role && item.role.type ? getRoleText(item.role.type) : 'æœªçŸ¥'}}
          </text>
        </view>
        <view class="meta-item">
          <text class="meta-label">æ‰€å±</text>
          <text class="meta-value">{{getBelongsTo(item)}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-row">
        <button
          class="action-btn primary"
          data-id="{{item._id}}"
          bindtap="onViewDetail"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>

        <button
          wx:if="{{item.role && item.role.status === 'normal'}}"
          class="action-btn warning"
          data-id="{{item._id}}"
          data-status="suspended"
          bindtap="onUpdateStatus"
        >
          åœç”¨
        </button>

        <button
          wx:if="{{item.role && item.role.status === 'suspended'}}"
          class="action-btn success"
          data-id="{{item._id}}"
          data-status="normal"
          bindtap="onUpdateStatus"
        >
          å¯ç”¨
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{users.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— ç”¨æˆ·æ•°æ®</text>
    </view>
  </view>
</view>
