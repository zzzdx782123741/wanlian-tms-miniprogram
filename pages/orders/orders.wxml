<!--pages/orders/orders.wxml - è®¢å•åˆ—è¡¨é¡µé¢ - ç°ä»£åŒ–è®¾è®¡-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">ç»´ä¿®è®¢å•</view>
    <view class="header-subtitle">ç®¡ç†å’Œè¿½è¸ªæ‚¨çš„ç»´ä¿®è®¢å•</view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰æ ‡ç­¾ -->
  <view class="filter-tabs">
    <view
      class="tab-item {{activeTab === 'all' ? 'active' : ''}}"
      data-tab="all"
      bindtap="onTabChange"
    >
      <text class="tab-text">å…¨éƒ¨</text>
      <text class="tab-badge" wx:if="{{counts.all > 0}}">{{counts.all}}</text>
    </view>
    <view
      class="tab-item {{activeTab === 'pending' ? 'active' : ''}}"
      data-tab="pending"
      bindtap="onTabChange"
    >
      <text class="tab-text">å¾…æ¥å•</text>
      <text class="tab-badge" wx:if="{{counts.pending > 0}}">{{counts.pending}}</text>
    </view>
    <view
      class="tab-item {{activeTab === 'processing' ? 'active' : ''}}"
      data-tab="processing"
      bindtap="onTabChange"
    >
      <text class="tab-text">è¿›è¡Œä¸­</text>
      <text class="tab-badge" wx:if="{{counts.processing > 0}}">{{counts.processing}}</text>
    </view>
    <view
      class="tab-item {{activeTab === 'completed' ? 'active' : ''}}"
      data-tab="completed"
      bindtap="onTabChange"
    >
      <text class="tab-text">å·²å®Œæˆ</text>
      <text class="tab-badge" wx:if="{{counts.completed > 0}}">{{counts.completed}}</text>
    </view>
  </view>

  <!-- è®¢å•åˆ—è¡¨ -->
  <view class="order-list">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && orders.length === 0}}">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— è®¢å•</text>
      <text class="empty-hint">å¿«å»åˆ›å»ºç¬¬ä¸€ä¸ªç»´ä¿®è®¢å•å§</text>
    </view>

    <!-- è®¢å•å¡ç‰‡ -->
    <view
      class="order-card"
      wx:for="{{orders}}"
      wx:key="_id"
      bindtap="onOrderTap"
      data-id="{{item._id}}"
    >
      <!-- è®¢å•çŠ¶æ€æ ‡ç­¾ -->
      <view class="order-status status-{{item.status}}">
        {{item.statusText}}
      </view>

      <!-- è®¢å•å¤´éƒ¨ -->
      <view class="order-header">
        <view class="order-number">è®¢å•å·ï¼š{{item.orderNumber}}</view>
        <view class="order-time">{{item.createdAtText}}</view>
      </view>

      <!-- è½¦è¾†ä¿¡æ¯ -->
      <view class="order-vehicle">
        <text class="vehicle-icon">ğŸšš</text>
        <view class="vehicle-info">
          <view class="vehicle-plate">{{item.vehicleInfo.plateNumber}}</view>
          <view class="vehicle-model">{{item.vehicleInfo.brand}} {{item.vehicleInfo.model}}</view>
        </view>
      </view>

      <!-- æ•…éšœæè¿° -->
      <view class="order-fault" wx:if="{{item.faultDescription}}">
        <text class="fault-label">æ•…éšœæè¿°ï¼š</text>
        <text class="fault-text">{{item.faultDescription}}</text>
      </view>

      <!-- è¿›åº¦æ¡ï¼ˆè¿›è¡Œä¸­çš„è®¢å•ï¼‰ -->
      <view class="order-progress" wx:if="{{item.showProgress}}">
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{item.progress}}%"></view>
        </view>
        <view class="progress-text">{{item.progressText}}</view>
      </view>

      <!-- è®¢å•åº•éƒ¨ä¿¡æ¯ -->
      <view class="order-footer">
        <view class="order-price" wx:if="{{item.quote}}">
          <text class="price-label">æŠ¥ä»·ï¼š</text>
          <text class="price-value">Â¥{{item.quote.total}}</text>
        </view>
        <view class="order-arrow">â€º</view>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-more" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
