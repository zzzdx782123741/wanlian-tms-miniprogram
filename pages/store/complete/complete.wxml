<!--pages/store/complete/complete.wxml - é—¨åº—æŠ€å¸ˆæäº¤å®Œå·¥-->
<view class="complete-container">
  <block wx:if="{{order}}">
    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="order-section glass-card">
      <view class="section-title">
        <text class="icon">ğŸ“‹</text>
        <text>è®¢å•ä¿¡æ¯</text>
      </view>

      <view class="info-row">
        <text class="label">è®¢å•å·</text>
        <text class="value">{{order.orderNumber}}</text>
      </view>

      <view class="info-row">
        <text class="label">è½¦ç‰Œå·</text>
        <text class="value">{{(order.vehicleId && order.vehicleId.plateNumber) || '-'}}</text>
      </view>

      <view class="info-row">
        <text class="label">è½¦å‹</text>
        <text class="value">{{(order.vehicleId && order.vehicleId.brand) || '-'}} {{(order.vehicleId && order.vehicleId.model) || ''}}</text>
      </view>

      <view class="info-row">
        <text class="label">å½“å‰é‡Œç¨‹</text>
        <text class="value">{{order.checkin && order.checkin.mileage ? order.checkin.mileage : (order.milestone || 'æœªå¡«å†™')}} å…¬é‡Œ</text>
      </view>
    </view>

    <!-- å®Œå·¥å›¾ç‰‡ -->
    <view class="form-section glass-card">
      <view class="section-title">
        <text class="icon">ğŸ“·</text>
        <text>å®Œå·¥ç…§ç‰‡</text>
        <text class="required-mark">*</text>
      </view>

      <view class="photo-hint">
        <text class="hint-icon">ğŸ’¡</text>
        <text class="hint-text">è¯·æ‹æ‘„ç»´ä¿®å®Œæˆåçš„è½¦è¾†ç…§ç‰‡ä½œä¸ºå‡­è¯ï¼Œè‡³å°‘ä¸Šä¼ ä¸€å¼ </text>
      </view>

      <view class="image-upload">
        <block wx:if="{{completionImages.length > 0}}">
          <view class="image-item" wx:for="{{completionImages}}" wx:key="index">
            <image
              class="uploaded-image"
              src="{{item}}"
              mode="aspectFill"
              bindtap="previewImage"
              data-url="{{item}}"
              data-urls="{{completionImages}}"
            />
            <view class="image-delete" bindtap="deleteImage" data-index="{{index}}">
              <text>âœ•</text>
            </view>
          </view>
        </block>

        <view class="upload-btn" wx:if="{{completionImages.length < 9}}" bindtap="chooseImage">
          <text class="upload-icon">ğŸ“·</text>
          <text class="upload-text">æ·»åŠ ç…§ç‰‡</text>
          <text class="upload-count">({{completionImages.length}}/9)</text>
        </view>
      </view>
    </view>

    <!-- å®Œå·¥è§†é¢‘ -->
    <view class="form-section glass-card">
      <view class="section-title">
        <text class="icon">ğŸ¬</text>
        <text>å®Œå·¥è§†é¢‘ï¼ˆé€‰å¡«ï¼‰</text>
      </view>

      <view class="video-hint">
        <text class="hint-icon">ğŸ’¡</text>
        <text class="hint-text">å¯ä¸Šä¼ ç»´ä¿®è¿‡ç¨‹çš„è§†é¢‘ï¼Œæœ€å¤š3ä¸ªï¼Œæ¯ä¸ªä¸è¶…è¿‡60ç§’</text>
      </view>

      <view class="video-list" wx:if="{{completionVideos.length > 0}}">
        <view class="video-item" wx:for="{{completionVideos}}" wx:key="index">
          <video
            class="uploaded-video"
            src="{{item}}"
            show-center-play-btn="{{true}}"
            controls="{{true}}"
          />
          <view class="video-delete" bindtap="deleteVideo" data-index="{{index}}">
            <text>âœ•</text>
          </view>
        </view>
      </view>

      <view class="upload-btn video-upload-btn" wx:if="{{completionVideos.length < 3}}" bindtap="chooseVideo">
        <text class="upload-icon">ğŸ¥</text>
        <text class="upload-text">æ·»åŠ è§†é¢‘</text>
        <text class="upload-count">({{completionVideos.length}}/3)</text>
      </view>
    </view>

    <!-- å®Œå·¥æè¿° -->
    <view class="form-section glass-card">
      <view class="section-title">
        <text class="icon">ğŸ’¬</text>
        <text>å®Œå·¥è¯´æ˜</text>
      </view>

      <textarea
        class="textarea-field"
        placeholder="è¯·æè¿°ç»´ä¿®å®Œæˆæƒ…å†µã€æ›´æ¢çš„é›¶ä»¶ã€æ³¨æ„äº‹é¡¹ç­‰ï¼ˆé€‰å¡«ï¼‰"
        value="{{description}}"
        bindinput="onDescriptionInput"
        maxlength="500"
      ></textarea>
      <view class="char-count">{{description.length}}/500</view>
    </view>

    <!-- å®Œå·¥æµç¨‹æç¤º -->
    <view class="process-hint">
      <view class="hint-title">ğŸ“¢ å®Œå·¥æµç¨‹</view>
      <view class="hint-steps">
        <view class="hint-step">
          <view class="step-number">1</view>
          <view class="step-text">æäº¤å®Œå·¥</view>
        </view>
        <view class="step-arrow">â†’</view>
        <view class="hint-step">
          <view class="step-number">2</view>
          <view class="step-text">å¸æœºç¡®è®¤</view>
        </view>
        <view class="step-arrow">â†’</view>
        <view class="hint-step">
          <view class="step-number">3</view>
          <view class="step-text">è®¢å•å®Œæˆ</view>
        </view>
      </view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <button
      class="submit-btn glass-btn-cta"
      bindtap="handleSubmit"
      disabled="{{submitting}}"
    >
      {{submitting ? 'æäº¤ä¸­...' : 'æäº¤å®Œå·¥'}}
    </button>
  </block>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
