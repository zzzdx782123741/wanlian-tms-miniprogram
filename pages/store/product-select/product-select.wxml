<!--pages/store/product-select/product-select.wxml - å•†å“é€‰æ‹©é¡µé¢-->
<view class="product-select-container">
  <!-- æœç´¢æ¡† -->
  <view class="search-section">
    <view class="search-box">
      <input
        class="search-input"
        placeholder="æœç´¢å•†å“åç§°ã€ç¼–ç ã€å“ç‰Œ"
        value="{{keyword}}"
        bindinput="onSearchInput"
        confirm-type="search"
        bindconfirm="onSearchConfirm"
      />
      <text class="search-icon">ğŸ”</text>
    </view>

    <!-- åˆ†ç±»ç­›é€‰ -->
    <scroll-view scroll-x class="category-tabs-scroll">
      <view class="category-tabs">
        <view
          class="category-tab {{activeCategory === '' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category=""
        >
          å…¨éƒ¨
        </view>
        <view
          class="category-tab {{activeCategory === 'parts' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category="parts"
        >
          é…ä»¶
        </view>
        <view
          class="category-tab {{activeCategory === 'labor' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category="labor"
        >
          å·¥æ—¶
        </view>
        <view
          class="category-tab {{activeCategory === 'service' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category="service"
        >
          æœåŠ¡
        </view>
        <view
          class="category-tab {{activeCategory === 'material' ? 'active' : ''}}"
          bindtap="onCategoryChange"
          data-category="material"
        >
          ææ–™
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list">
    <block wx:if="{{!loading && products.length > 0}}">
      <view
        class="product-item"
        wx:for="{{products}}"
        wx:key="_id"
      >
        <!-- å•†å“å›¾ç‰‡åŒºåŸŸ -->
        <view
          class="product-image-wrapper"
          bindtap="previewImage"
          data-url="{{item.images && item.images.length > 0 ? item.images[0] : ''}}"
          data-urls="{{item.images || []}}"
        >
          <image
            class="product-image"
            src="{{item.images && item.images.length > 0 ? item.images[0] : '/images/product-placeholder.png'}}"
            mode="aspectFill"
          />
          <view class="image-hint">ç‚¹å‡»æ”¾å¤§</view>
        </view>

        <!-- å•†å“ä¿¡æ¯åŒºåŸŸ -->
        <view class="product-info">
          <view class="product-header">
            <view class="product-name">{{item.name}}</view>
            <view class="product-category category-{{item.category}}">{{item.categoryText}}</view>
          </view>

          <view class="product-spec">
            <text class="spec-item" wx:if="{{item.brand}}">ğŸ·ï¸ {{item.brand}}</text>
            <text class="spec-item" wx:if="{{item.spec}}">ğŸ“ {{item.spec}}</text>
          </view>

          <view class="product-models">
            <text class="models-icon">ğŸš—</text>
            <text class="models-text">{{item.isUniversal ? 'é€šç”¨' : item.compatibleModels.join('ã€')}}</text>
          </view>

          <view class="product-footer">
            <view class="product-price-row">
              <text class="product-price">Â¥{{item.price}}</text>
              <text class="product-unit">/{{item.unit}}</text>
            </view>
            <view class="product-stock">åº“å­˜: {{item.stock}}</view>
          </view>

          <!-- é€‰æ‹©æŒ‰é’® -->
          <view class="select-btn" bindtap="onSelectProduct" data-product="{{item}}">
            <text class="select-icon">â•</text>
            <text class="select-text">æ·»åŠ </text>
          </view>
        </view>
      </view>
    </block>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— å•†å“</text>
      <text class="empty-hint">è¯·å°è¯•å…¶ä»–æœç´¢å…³é”®è¯</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <text>æœç´¢ä¸­...</text>
    </view>
  </view>
</view>
