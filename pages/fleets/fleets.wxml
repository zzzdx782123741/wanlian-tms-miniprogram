<!--pages/fleets/fleets.wxml - è½¦é˜Ÿç®¡ç†é¡µé¢-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">è½¦é˜Ÿç®¡ç†</view>
    <view class="header-subtitle">ç®¡ç†å¹³å°æ‰€æœ‰è½¦é˜Ÿ</view>
  </view>

  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="search-bar">
    <view class="search-row">
      <picker
        mode="selector"
        range="{{statusOptions}}"
        range-key="label"
        value="{{statusIndex}}"
        bindchange="onStatusChange"
      >
        <view class="filter-picker">
          <text>{{statusOptions[statusIndex].label}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>
    <view class="search-row">
      <input
        class="search-input"
        placeholder="æœç´¢è½¦é˜Ÿåç§°"
        value="{{keyword}}"
        bindinput="onSearchInput"
        bindconfirm="onSearch"
      />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- è½¦é˜Ÿåˆ—è¡¨ -->
  <view class="list-container">
    <view
      class="fleet-card"
      wx:for="{{fleets}}"
      wx:key="_id"
    >
      <!-- è½¦é˜ŸåŸºæœ¬ä¿¡æ¯ -->
      <view class="fleet-header">
        <view class="fleet-name">{{item.name}}</view>
        <view class="fleet-status status-{{item.status}}">
          {{item.status === 'pending_audit' ? 'å¾…å®¡æ ¸' : item.status === 'normal' ? 'æ­£å¸¸' : 'å·²åœç”¨'}}
        </view>
      </view>

      <!-- è½¦é˜Ÿè¯¦ç»†ä¿¡æ¯ -->
      <view class="fleet-info">
        <view class="info-row">
          <text class="label">è”ç³»äººï¼š</text>
          <text class="value">{{item.contact.name}}</text>
        </view>
        <view class="info-row">
          <text class="label">è”ç³»ç”µè¯ï¼š</text>
          <text class="value">{{item.contact.phone}}</text>
        </view>
        <view class="info-row">
          <text class="label">è½¦é˜Ÿè§„æ¨¡ï¼š</text>
          <text class="value">{{item.scale}} è¾†</text>
        </view>
        <view class="info-row">
          <text class="label">åœ°å€ï¼š</text>
          <text class="value">{{item.address.city}}{{item.address.district}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-row">
        <button
          class="action-btn primary"
          data-id="{{item._id}}"
          bindtap="onViewDetail"
        >
          æŸ¥çœ‹è¯¦æƒ…
        </button>

        <button
          wx:if="{{item.status === 'pending_audit'}}"
          class="action-btn success"
          data-id="{{item._id}}"
          bindtap="onApprove"
        >
          å®¡æ ¸é€šè¿‡
        </button>

        <button
          wx:if="{{item.status === 'normal'}}"
          class="action-btn warning"
          data-id="{{item._id}}"
          data-status="suspended"
          bindtap="onUpdateStatus"
        >
          åœç”¨
        </button>

        <button
          wx:if="{{item.status === 'suspended'}}"
          class="action-btn success"
          data-id="{{item._id}}"
          data-status="normal"
          bindtap="onUpdateStatus"
        >
          å¯ç”¨
        </button>

        <button
          class="action-btn danger"
          data-id="{{item._id}}"
          bindtap="onDelete"
        >
          åˆ é™¤
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{fleets.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ¢</text>
      <text class="empty-text">æš‚æ— è½¦é˜Ÿæ•°æ®</text>
    </view>
  </view>
</view>
