<!--pages/order-detail/order-detail.wxml - è®¢å•è¯¦æƒ…é¡µé¢-->
<view class="page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è®¢å•è¯¦æƒ… -->
  <view class="order-detail" wx:if="{{!loading && order}}">
    <!-- é¡¶éƒ¨çŠ¶æ€å¡ç‰‡ -->
    <view class="status-card status-{{order.status}}">
      <view class="status-icon">{{order.statusIcon}}</view>
      <view class="status-info">
        <view class="status-text">{{order.statusText}}</view>
        <view class="status-hint">{{order.statusHint}}</view>
      </view>
    </view>

    <!-- è¿›åº¦æ—¶é—´çº¿ -->
    <view class="timeline" wx:if="{{order.timeline && order.timeline.length > 0}}">
      <view class="timeline-item" wx:for="{{order.timeline}}" wx:key="index">
        <view class="timeline-dot {{item.completed ? 'active' : ''}}"></view>
        <view class="timeline-content">
          <view class="timeline-title">{{item.title}}</view>
          <view class="timeline-time" wx:if="{{item.time}}">{{item.time}}</view>
        </view>
      </view>
    </view>

    <!-- æ‹’ç»åŸå› ä¿¡æ¯ï¼ˆè¢«æ‹’ç»çš„è®¢å•æ˜¾ç¤ºï¼‰ -->
    <view class="info-card reject-card" wx:if="{{order.status === 'rejected' && order.rejectReason}}">
      <view class="reject-header">
        <text class="reject-icon">âŒ</text>
        <text class="reject-title">è®¢å•å·²è¢«æ‹’ç»</text>
      </view>
      <view class="reject-reason">
        <text class="reject-reason-label">æ‹’ç»åŸå› ï¼š</text>
        <text class="reject-reason-text">{{order.rejectReason}}</text>
      </view>
      <view class="reject-tip">è¯·æ ¹æ®æ‹’ç»åŸå› ä¿®æ”¹è®¢å•ä¿¡æ¯åé‡æ–°æäº¤</view>
    </view>

    <!-- è®¢å•åŸºæœ¬ä¿¡æ¯ -->
    <view class="info-card">
      <view class="card-title">è®¢å•ä¿¡æ¯</view>
      <view class="info-row">
        <text class="info-label">è®¢å•ç¼–å·</text>
        <text class="info-value">{{order.orderNumber}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">åˆ›å»ºæ—¶é—´</text>
        <text class="info-value">{{order.createdAtText}}</text>
      </view>
    </view>

    <!-- è½¦è¾†ä¿¡æ¯ -->
    <view class="info-card" bindtap="onVehicleDetail" data-vehicle-id="{{order.vehicleId._id}}">
      <view class="card-title">è½¦è¾†ä¿¡æ¯</view>
      <view class="vehicle-info">
        <view class="vehicle-main">
          <text class="vehicle-plate">{{order.vehicleId.plateNumber}}</text>
          <text class="vehicle-model">{{order.vehicleId.brand}} {{order.vehicleId.model}}</text>
        </view>
        <text class="arrow-icon">â€º</text>
      </view>
        <!-- è½¦é˜Ÿä¿¡æ¯ -->
      <view class="fleet-info" wx:if="{{order.fleetId}}">
        <text class="fleet-label">å½’å±è½¦é˜Ÿï¼š</text>
        <text class="fleet-name">{{order.fleetId.name}}</text>
      </view>
    </view>

    <!-- å¸æœºä¿¡æ¯ï¼ˆæäº¤äººä¿¡æ¯ï¼‰ -->
    <view class="info-card" wx:if="{{order.reporterId}}">
      <view class="card-title">æäº¤äººä¿¡æ¯</view>
      <view class="reporter-detail">
        <view class="reporter-name-row">
          <text class="reporter-name">{{order.reporterId.nickname}}</text>
          <text class="reporter-role" wx:if="{{order.reporterId.role}}">
            {{order.reporterId.role.type === 'DRIVER' ? 'å¸æœº' : ''}}
          </text>
        </view>
        <view class="reporter-contact" wx:if="{{order.reporterId.phone}}">
          <text class="contact-icon">ğŸ“</text>
          <text class="contact-phone">{{order.reporterId.phone}}</text>
        </view>
      </view>
      <!-- è”ç³»å¸æœºæŒ‰é’® -->
      <button class="contact-btn" wx:if="{{order.reporterId.phone && userRole === 'FLEET_MANAGER'}}" bindtap="onContactReporter">
        <text class="btn-icon">ğŸ“</text>
        è”ç³»å¸æœº
      </button>
    </view>

    <!-- æ•…éšœæè¿°ï¼ˆç»´ä¿®è®¢å•ï¼‰ -->
    <view class="info-card" wx:if="{{order.type === 'repair'}}">
      <view class="card-title">æ•…éšœæè¿°</view>
      <view class="fault-content">{{order.faultDescription}}</view>
      <!-- æ•…éšœå›¾ç‰‡ -->
      <view class="fault-images" wx:if="{{order.faultImages && order.faultImages.length > 0}}">
        <image
          class="fault-image"
          wx:for="{{order.faultImages}}"
          wx:for-item="image"
          wx:key="*this"
          src="{{image}}"
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-url="{{image}}"
          data-urls="{{order.faultImages}}"
        />
      </view>
    </view>

    <!-- è½¦è¾†ä½ç½®ï¼ˆæ‰€æœ‰è®¢å•éƒ½æ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.serviceLocation && order.serviceLocation.address}}">
      <view class="card-title">è½¦è¾†ä½ç½®</view>
      <view class="service-location-info">
        <text class="location-icon">ğŸ“</text>
        <text class="location-text">{{order.serviceLocation.address}}</text>
      </view>
    </view>

    <!-- ä¿å…»ä¿¡æ¯ï¼ˆä¿å…»è®¢å•ï¼‰ -->
    <view class="info-card" wx:if="{{order.type === 'maintenance'}}">
      <view class="card-title">ä¿å…»ä¿¡æ¯</view>
      <view class="maint-info-row">
        <text class="maint-label">ä¿å…»ç±»å‹ï¼š</text>
        <text class="maint-value">{{order.maintenanceOrder.maintenanceTypeName}}</text>
      </view>
      <view class="maint-info-row">
        <text class="maint-label">å¥—é¤ï¼š</text>
        <text class="maint-value">{{order.maintenanceOrder.packageName || order.maintenanceOrder.selectedTier}}</text>
      </view>
      <view class="maint-info-row" wx:if="{{order.maintenanceOrder.serviceLocation}}">
        <text class="maint-label">æœåŠ¡åœ°å€ï¼š</text>
        <text class="maint-value">{{order.maintenanceOrder.serviceLocation.address}}</text>
      </view>
      <view class="maint-info-row" wx:if="{{order.maintenanceOrder.preferredTime}}">
        <text class="maint-label">æœŸæœ›æ—¶é—´ï¼š</text>
        <text class="maint-value">{{order.maintenanceOrder.preferredTime}}</text>
      </view>
      <view class="maint-info-row" wx:if="{{order.maintenanceOrder.driverRemark}}">
        <text class="maint-label">å¸æœºå¤‡æ³¨ï¼š</text>
        <text class="maint-value">{{order.maintenanceOrder.driverRemark}}</text>
      </view>
      <!-- è½¦é˜Ÿå®¡æ‰¹åæ˜¾ç¤º -->
      <view class="maint-approval" wx:if="{{order.maintenanceOrder.approvedAt}}">
        <view class="approval-divider"></view>
        <view class="maint-info-row" wx:if="{{order.maintenanceOrder.confirmedStoreId}}">
          <text class="maint-label">ç¡®è®¤é—¨åº—ï¼š</text>
          <text class="maint-value">{{order.maintenanceOrder.confirmedStoreName}}</text>
        </view>
        <view class="maint-info-row" wx:if="{{order.maintenanceOrder.finalAmount}}">
          <text class="maint-label">æœ€ç»ˆé‡‘é¢ï¼š</text>
          <text class="maint-value price">Â¥{{order.maintenanceOrder.finalAmount}}</text>
        </view>
        <view class="maint-info-row" wx:if="{{order.maintenanceOrder.fleetRemark}}">
          <text class="maint-label">è½¦é˜Ÿå¤‡æ³¨ï¼š</text>
          <text class="maint-value">{{order.maintenanceOrder.fleetRemark}}</text>
        </view>
      </view>
    </view>

    <!-- é—¨åº—ä¿¡æ¯ï¼ˆå·²æ¥å•åæ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.storeId}}">
      <view class="card-title">ç»´ä¿®é—¨åº—</view>
      <view class="store-info">
        <view class="store-name">{{order.storeId.name}}</view>
        <view class="store-detail">
          <text class="detail-icon">ğŸ“</text>
          <text>{{order.storeId.address.city}} {{order.storeId.address.district}} {{order.storeId.address.detail}}</text>
        </view>
        <view class="store-detail" wx:if="{{order.storeId.contact && order.storeId.contact.phone}}">
          <text class="detail-icon">ğŸ“</text>
          <text>{{order.storeId.contact.phone}}</text>
        </view>
      </view>
      <!-- å¸æœºå’Œè½¦é˜Ÿç®¡ç†å‘˜å¯ä»¥è”ç³»é—¨åº—ï¼Œé—¨åº—æŠ€å¸ˆä¸éœ€è¦ -->
      <button class="contact-btn" wx:if="{{userRole !== 'STORE_TECHNICIAN'}}" bindtap="onContactStore">
        <text class="btn-icon">ğŸ“</text>
        è”ç³»é—¨åº—
      </button>
    </view>

    <!-- æ¥è½¦æ£€æŸ¥ä¿¡æ¯ï¼ˆé—¨åº—æ£€æŸ¥åæ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.receiveCheck && (order.receiveCheck.mileage || order.receiveCheck.diagnosis || order.receiveCheck.checkinPhotos)}}">
      <view class="check-info">
        <view class="info-row" wx:if="{{order.receiveCheck.mileage}}">
          <text class="info-label">å½“å‰é‡Œç¨‹</text>
          <text class="info-value">{{order.receiveCheck.mileage}} å…¬é‡Œ</text>
        </view>
        <view class="check-diagnosis" wx:if="{{order.receiveCheck.diagnosis}}">
          <view class="diagnosis-label">è¯Šæ–­ç»“æœ</view>
          <text class="diagnosis-text">{{order.receiveCheck.diagnosis}}</text>
        </view>
        <!-- æ¥è½¦æ£€æŸ¥ç…§ç‰‡ -->
        <view class="check-photos" wx:if="{{order.receiveCheck.checkinPhotos && order.receiveCheck.checkinPhotos.length > 0}}">
          <image
            class="check-photo"
            wx:for="{{order.receiveCheck.checkinPhotos}}"
            wx:for-item="photo"
            wx:key="*this"
            src="{{photo}}"
            mode="aspectFill"
            bindtap="onPreviewImage"
            data-url="{{photo}}"
            data-urls="{{order.receiveCheck.checkinPhotos}}"
          />
        </view>
      </view>
    </view>

    <!-- ç»´ä¿®æŠ¥ä»·ï¼ˆå·²æŠ¥ä»·åæ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.quote && order.quote.items && order.quote.items.length > 0}}">
      <view class="card-title">ç»´ä¿®æŠ¥ä»·</view>
      <view class="quote-items">
        <view class="quote-item" wx:for="{{order.quote.items}}" wx:key="item">
          <view class="item-name">{{item.item}}</view>
          <view class="item-price">Â¥{{item.price}} Ã— {{item.quantity}}</view>
          <view class="item-subtotal">Â¥{{item.price * item.quantity}}</view>
        </view>
      </view>
      <view class="quote-total">
        <text class="total-label">æ€»è®¡ï¼š</text>
        <text class="total-value">Â¥{{order.quote.total}}</text>
      </view>
      <!-- æŠ¥ä»·å›¾ç‰‡ -->
      <view class="quote-images" wx:if="{{order.quote.images && order.quote.images.length > 0}}">
        <image
          class="quote-image"
          wx:for="{{order.quote.images}}"
          wx:for-item="image"
          wx:key="*this"
          src="{{image}}"
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-url="{{image}}"
          data-urls="{{order.quote.images}}"
        />
      </view>
    </view>

    <!-- ç»´ä¿®æ—¥å¿— -->
    <view class="info-card" wx:if="{{order.logs && order.logs.length > 0}}">
      <view class="card-title">ç»´ä¿®æ—¥å¿—</view>
      <view class="log-list">
        <view class="log-item" wx:for="{{order.logs}}" wx:key="_id">
          <view class="log-header">
            <text class="log-operator">{{item.operatorId.nickname}}</text>
            <text class="log-time">{{item.createdAtText}}</text>
          </view>
          <view class="log-content">{{item.content}}</view>
          <!-- æ—¥å¿—å›¾ç‰‡ -->
          <view class="log-images" wx:if="{{item.images && item.images.length > 0}}">
            <image
              class="log-image"
              wx:for="{{item.images}}"
              wx:for-item="image"
              wx:key="*this"
              src="{{image}}"
              mode="aspectFill"
              bindtap="onPreviewImage"
              data-url="{{image}}"
              data-urls="{{item.images}}"
            />
          </view>
        </view>
      </view>
    </view>

    <!-- å®Œå·¥ä¿¡æ¯ï¼ˆå·²å®Œå·¥åæ˜¾ç¤ºï¼‰ -->
    <view class="info-card" wx:if="{{order.completion}}">
      <view class="card-title">å®Œå·¥ä¿¡æ¯</view>
      <view class="completion-content">{{order.completion.description}}</view>
      <!-- å®Œå·¥å›¾ç‰‡ -->
      <view class="completion-images" wx:if="{{order.completion.images && order.completion.images.length > 0}}">
        <image
          class="completion-image"
          wx:for="{{order.completion.images}}"
          wx:for-item="image"
          wx:key="*this"
          src="{{image}}"
          mode="aspectFill"
          bindtap="onPreviewImage"
          data-url="{{image}}"
          data-urls="{{order.completion.images}}"
        />
      </view>
      <!-- ç¡®è®¤ä¿¡æ¯ -->
      <view class="confirm-info" wx:if="{{order.completion.confirmedBy}}">
        <view class="confirm-row">
          <text class="confirm-icon">âœ“</text>
          <text class="confirm-label">ç¡®è®¤çŠ¶æ€ï¼š</text>
          <text class="confirm-value">å·²ç¡®è®¤</text>
        </view>
        <view class="confirm-time" wx:if="{{order.completion.confirmedAtText}}">
          ç¡®è®¤æ—¶é—´ï¼š{{order.completion.confirmedAtText}}
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
    <view class="action-bar">
      <!-- è½¦é˜Ÿç®¡ç†å‘˜å®¡æ‰¹åŒºåŸŸ - å¾…è½¦é˜Ÿå®¡æ‰¹çŠ¶æ€ -->
      <view class="fleet-approve-section" wx:if="{{order.status === 'awaiting_fleet_approval' && userRole === 'FLEET_MANAGER'}}">
        <!-- é—¨åº—é€‰æ‹©æç¤º -->
        <view class="approve-tip" wx:if="{{!order.storeId && !selectedStoreId}}">
          <text class="tip-icon">ğŸ’¡</text>
          <text class="tip-text">è¯·å…ˆä¸ºè®¢å•åˆ†é…é—¨åº—ï¼Œå†è¿›è¡Œå®¡æ‰¹</text>
        </view>

        <!-- é€‰æ‹©é—¨åº—æŒ‰é’®ï¼ˆæœªåˆ†é…é—¨åº—æ—¶æ˜¾ç¤ºï¼‰ -->
        <button
          class="action-btn select-store"
          wx:if="{{!order.storeId && !selectedStoreId}}"
          bindtap="onSelectStore"
        >
          <text class="btn-icon">ğŸª</text>
          é€‰æ‹©é—¨åº—
        </button>

        <!-- å·²é€‰é—¨åº—æç¤ºï¼ˆç‚¹å‡»å¯é‡é€‰ï¼‰ -->
        <view class="selected-store-tip" wx:if="{{order.storeId || selectedStoreId}}" bindtap="onSelectStore">
          <view class="selected-store-content">
            <text class="store-icon">ğŸª</text>
            <view class="selected-store-info">
              <text class="store-name">{{selectedStoreName || order.storeId.name}}</text>
              <text class="store-hint">ç‚¹å‡»å¯æ›´æ¢é—¨åº—</text>
            </view>
            <text class="store-change-icon">â€º</text>
          </view>
        </view>

        <!-- å®¡æ‰¹æŒ‰é’®ï¼ˆå·²åˆ†é…é—¨åº—åæ˜¾ç¤ºï¼‰ -->
        <button
          class="action-btn approve"
          wx:if="{{order.storeId || selectedStoreId}}"
          bindtap="onFleetApproveWithStore"
        >
          <text class="btn-icon">âœ“</text>
          å®¡æ‰¹é€šè¿‡
        </button>

        <!-- æ‹’ç»æŒ‰é’®ï¼ˆéšæ—¶å¯ç”¨ï¼‰ -->
        <button
          class="action-btn reject"
          bindtap="onFleetRejectOrder"
        >
          <text class="btn-icon">âœ•</text>
          å®¡æ‰¹æ‹’ç»
        </button>
      </view>

      <!-- è½¦é˜Ÿç®¡ç†å‘˜å®¡æ‰¹æŒ‰é’® - å¾…å®¡æ‰¹æŠ¥ä»·çŠ¶æ€ -->
      <button
        class="action-btn approve"
        wx:if="{{order.status === 'awaiting_approval' && userRole === 'FLEET_MANAGER'}}"
        bindtap="onApproveQuote"
        data-approved="{{true}}"
      >
        <text class="btn-icon">âœ“</text>
        æ‰¹å‡†æŠ¥ä»·
      </button>
      <button
        class="action-btn reject"
        wx:if="{{order.status === 'awaiting_approval' && userRole === 'FLEET_MANAGER'}}"
        bindtap="onApproveQuote"
        data-approved="{{false}}"
      >
        <text class="btn-icon">âœ•</text>
        æ‹’ç»æŠ¥ä»·
      </button>

      <!-- é—¨åº—æŠ€å¸ˆæ“ä½œæŒ‰é’® -->
      <button
        class="action-btn primary"
        wx:if="{{order.status === 'pending_assessment' && userRole === 'STORE_TECHNICIAN'}}"
        bindtap="onSubmitQuote"
      >
        <text class="btn-icon">ğŸ“‹</text>
        æ¥è½¦æ£€æŸ¥ä¸æŠ¥ä»·
      </button>
      <button
        class="action-btn primary"
        wx:if="{{order.status === 'in_repair' && userRole === 'STORE_TECHNICIAN'}}"
        bindtap="onCompleteOrder"
      >
        <text class="btn-icon">âœ“</text>
        æäº¤å®Œå·¥
      </button>

      <!-- å¸æœºç¡®è®¤æŒ‰é’® -->
      <button
        class="action-btn confirm"
        wx:if="{{order.status === 'completed' && userRole === 'DRIVER' && !(order.completion && order.completion.confirmedBy)}}"
        bindtap="onConfirmOrder"
      >
        <text class="btn-icon">âœ“</text>
        ç¡®è®¤å®Œå·¥
      </button>

      <!-- å¸æœºå»è¯„ä»·æŒ‰é’®ï¼ˆå·²å®Œæˆä¸”å·²ç¡®è®¤ä½†æœªè¯„ä»·ï¼Œ15å¤©å†…ï¼‰ -->
      <button
        class="action-btn review"
        wx:if="{{order.status === 'completed' && userRole === 'DRIVER' && order.completion && order.completion.confirmedBy && !order.reviewed && order.canReview}}"
        bindtap="onReviewOrder"
      >
        <text class="btn-icon">â­</text>
        å»è¯„ä»·
      </button>

      <!-- å¸æœºé‡æ–°æäº¤æŒ‰é’®ï¼ˆè¢«æ‹’ç»çš„è®¢å•ï¼‰ -->
      <button
        class="action-btn resubmit"
        wx:if="{{order.status === 'rejected' && userRole === 'DRIVER'}}"
        bindtap="onResubmitOrder"
      >
        <text class="btn-icon">ğŸ”„</text>
        é‡æ–°æäº¤
      </button>

      <!-- æŸ¥çœ‹æ‹’ç»åŸå› æŒ‰é’®ï¼ˆéå¸æœºè§’è‰²æŸ¥çœ‹è¢«æ‹’ç»è®¢å•ï¼‰ -->
      <button
        class="action-btn info"
        wx:if="{{order.status === 'rejected' && userRole !== 'DRIVER'}}"
        bindtap="onViewRejectReason"
      >
        <text class="btn-icon">ğŸ‘</text>
        æŸ¥çœ‹æ‹’ç»åŸå› 
      </button>

      <!-- å·²ç¡®è®¤æç¤º -->
      <view class="confirmed-notice" wx:if="{{order.status === 'completed' && order.completion && order.completion.confirmedBy}}">
        <text class="notice-icon">âœ“</text>
        <text class="notice-text">æ‚¨å·²ç¡®è®¤å®Œå·¥</text>
      </view>
    </view>
  </view>

  <!-- é—¨åº—é€‰æ‹©å¼¹çª— -->
  <view class="store-picker-mask" wx:if="{{showStorePicker}}" bindtap="onCloseStorePicker">
    <view class="store-picker-popup" catchtap="">
      <view class="store-picker-header">
        <text class="store-picker-title">é€‰æ‹©é—¨åº—</text>
        <text class="store-picker-close" bindtap="onCloseStorePicker">âœ•</text>
      </view>
      <scroll-view class="store-picker-list" scroll-y>
        <view
          class="store-picker-item {{selectedStoreId === item._id ? 'active' : ''}}"
          wx:for="{{storeList}}"
          wx:key="_id"
        >
          <view class="store-item-main" bindtap="onSelectStoreItem" data-store-id="{{item._id}}" data-store-name="{{item.name}}">
            <view class="store-item-header">
              <view class="store-item-name">{{item.name}}</view>
              <view class="store-item-check" wx:if="{{selectedStoreId === item._id}}">âœ“</view>
            </view>
            <view class="store-item-info">
              <text class="store-item-distance" wx:if="{{item.distance !== undefined}}">{{item.distance}}km</text>
              <text class="store-item-location" wx:if="{{item.address && item.address.district}}">ğŸ“ {{item.address.district}}</text>
              <text class="store-item-rating" wx:if="{{item.ratingStats && item.ratingStats.overallRating > 0}}">
                {{item.ratingStats.overallRating}}åˆ†
                <text wx:if="{{item.ratingStats.reviewCount > 0}}">ï¼ˆ{{item.ratingStats.reviewCount}}æ¡ï¼‰</text>
              </text>
              <text class="store-item-rating" wx:else>æš‚æ— è¯„ä»·</text>
            </view>
            <view class="store-item-details">
              <view class="store-item-detail" wx:if="{{item.businessHours}}">
                <text class="detail-icon">ğŸ•</text>
                <text class="detail-text">{{item.businessHours}}</text>
              </view>
              <view class="store-item-detail" wx:if="{{item.contact && item.contact.phone}}">
                <text class="detail-icon">ğŸ“</text>
                <text class="detail-text">{{item.contact.phone}}</text>
              </view>
            </view>
          </view>
          <view class="store-item-actions">
            <button class="store-detail-btn" catchtap="onViewStoreDetail" data-store="{{item}}">æŸ¥çœ‹è¯¦æƒ…</button>
          </view>
        </view>
      </scroll-view>
      <view class="store-picker-footer">
        <button class="store-picker-cancel" bindtap="onCloseStorePicker">å–æ¶ˆ</button>
        <button class="store-picker-confirm" bindtap="onConfirmStoreSelect" disabled="{{!selectedStoreId}}">ç¡®è®¤</button>
      </view>
    </view>
  </view>

  <!-- é—¨åº—è¯¦æƒ…å¼¹çª— -->
  <view class="store-detail-mask" wx:if="{{showStoreDetail}}" bindtap="onCloseStoreDetail">
    <view class="store-detail-popup" catchtap="">
      <view class="store-detail-header">
        <view class="store-detail-title">{{storeDetail.name}}</view>
        <text class="store-detail-close" bindtap="onCloseStoreDetail">âœ•</text>
      </view>

      <scroll-view class="store-detail-content" scroll-y>
        <!-- è¯„åˆ†æ¦‚è§ˆ -->
        <view class="detail-rating-card">
          <view class="rating-overview">
            <text class="rating-score">{{storeDetail.ratingStats.overallRating || 0}}</text>
            <view class="rating-stars">
              <text class="star">{{storeDetail.ratingStats.overallRating >= 1 ? 'â˜…' : 'â˜†'}}</text>
              <text class="star">{{storeDetail.ratingStats.overallRating >= 2 ? 'â˜…' : 'â˜†'}}</text>
              <text class="star">{{storeDetail.ratingStats.overallRating >= 3 ? 'â˜…' : 'â˜†'}}</text>
              <text class="star">{{storeDetail.ratingStats.overallRating >= 4 ? 'â˜…' : 'â˜†'}}</text>
              <text class="star">{{storeDetail.ratingStats.overallRating >= 5 ? 'â˜…' : 'â˜†'}}</text>
            </view>
            <text class="rating-count">{{storeDetail.ratingStats.reviewCount || 0}}æ¡è¯„ä»·</text>
          </view>
        </view>

        <!-- é—¨åº—ä¿¡æ¯ -->
        <view class="detail-section">
          <view class="detail-section-title">é—¨åº—ä¿¡æ¯</view>
          <view class="detail-info-list">
            <view class="detail-info-item" wx:if="{{storeDetail.address}}">
              <text class="info-icon">ğŸ“</text>
              <text class="info-text">{{storeDetail.address.city}} {{storeDetail.address.district}} {{storeDetail.address.detail}}</text>
            </view>
            <view class="detail-info-item" wx:if="{{storeDetail.businessHours}}">
              <text class="info-icon">ğŸ•</text>
              <text class="info-text">{{storeDetail.businessHours}}</text>
            </view>
            <view class="detail-info-item" wx:if="{{storeDetail.contact.phone}}">
              <text class="info-icon">ğŸ“</text>
              <text class="info-text">{{storeDetail.contact.phone}}</text>
            </view>
          </view>
        </view>

        <!-- æœ€è¿‘è¯„ä»· -->
        <view class="detail-section" wx:if="{{storeDetailReviews && storeDetailReviews.length > 0}}">
          <view class="detail-section-title">æœ€è¿‘è¯„ä»·</view>
          <view class="review-list">
            <view class="review-item" wx:for="{{storeDetailReviews}}" wx:key="_id" wx:for-item="review">
              <view class="review-header">
                <view class="review-author">{{review.anonymous ? 'åŒ¿åç”¨æˆ·' : review.reviewerId.nickname}}</view>
                <view class="review-rating">
                  <text class="review-star" wx:for="{{5}}" wx:for-item="star" wx:key="*this">
                    {{star <= review.overallRating ? 'â˜…' : 'â˜†'}}
                  </text>
                </view>
              </view>
              <view class="review-comment" wx:if="{{review.comment}}">{{review.comment}}</view>
              <view class="review-time">{{review.createdAtText}}</view>
            </view>
          </view>
        </view>

        <!-- æš‚æ— è¯„ä»·æç¤º -->
        <view class="detail-section" wx:else>
          <view class="no-reviews">
            <text class="no-reviews-icon">ğŸ’¬</text>
            <text class="no-reviews-text">æš‚æ— è¯„ä»·</text>
            <text class="no-reviews-hint">æˆä¸ºç¬¬ä¸€ä¸ªè¯„ä»·çš„äºº</text>
          </view>
        </view>
      </scroll-view>

      <!-- åº•éƒ¨æ“ä½œ -->
      <view class="store-detail-footer">
        <button class="detail-close-btn" bindtap="onCloseStoreDetail">å…³é—­</button>
      </view>
    </view>
  </view>
</view>
