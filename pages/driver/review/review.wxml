<!--pages/driver/review/review.wxml - é—¨åº—è¯„ä»·é¡µé¢-->
<view class="review-page">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è¯„ä»·è¡¨å• -->
  <view class="review-form" wx:if="{{!loading && order && store}}">
    <!-- é¡¶éƒ¨æç¤º -->
    <view class="review-header">
      <text class="header-title">æœåŠ¡è¯„ä»·</text>
      <text class="header-subtitle">æ‚¨çš„è¯„ä»·èƒ½å¸®åŠ©æˆ‘ä»¬æä¾›æ›´å¥½çš„æœåŠ¡</text>
    </view>

    <!-- é—¨åº—ä¿¡æ¯ -->
    <view class="store-info-card" wx:if="{{store}}">
      <view class="store-name">{{store.name || 'ç»´ä¿®é—¨åº—'}}</view>
      <view class="store-address" wx:if="{{store.address}}">
        <text class="address-icon">ğŸ“</text>
        <text wx:if="{{store.address.full}}">{{store.address.full}}</text>
        <text wx:elif="{{store.address.city}}">{{store.address.city}}{{store.address.district || ''}}{{store.address.detail || ''}}</text>
        <text wx:else>{{store.address}}</text>
      </view>
    </view>

    <!-- è¯„åˆ†åŒºåŸŸ -->
    <view class="rating-section">
      <!-- æŠ€æœ¯ä¸“ä¸šåº¦ -->
      <view class="rating-item">
        <view class="rating-label">
          <text class="label-icon">ğŸ”§</text>
          <text class="label-text">æŠ€æœ¯ä¸“ä¸šåº¦</text>
        </view>
        <view class="rating-stars">
          <block wx:for="{{[1, 2, 3, 4, 5]}}" wx:key="index">
            <view
              class="star {{ratings.technicalSkill >= index ? 'active' : ''}} {{ratings.technicalSkill >= index + 0.5 && ratings.technicalSkill < index ? 'half' : ''}}"
              bindtap="onRateStar"
              data-field="technicalSkill"
              data-value="{{index}}"
            >
              <text class="star-icon">â˜…</text>
            </view>
          </block>
        </view>
        <view class="rating-text">{{ratingTexts[ratings.technicalSkill]}}</view>
      </view>

      <!-- æœåŠ¡æ•ˆç‡ -->
      <view class="rating-item">
        <view class="rating-label">
          <text class="label-icon">âš¡</text>
          <text class="label-text">æœåŠ¡æ•ˆç‡</text>
        </view>
        <view class="rating-stars">
          <block wx:for="{{[1, 2, 3, 4, 5]}}" wx:key="index">
            <view
              class="star {{ratings.serviceEfficiency >= index ? 'active' : ''}} {{ratings.serviceEfficiency >= index + 0.5 && ratings.serviceEfficiency < index ? 'half' : ''}}"
              bindtap="onRateStar"
              data-field="serviceEfficiency"
              data-value="{{index}}"
            >
              <text class="star-icon">â˜…</text>
            </view>
          </block>
        </view>
        <view class="rating-text">{{ratingTexts[ratings.serviceEfficiency]}}</view>
      </view>

      <!-- æ”¶è´¹é€æ˜åº¦ -->
      <view class="rating-item">
        <view class="rating-label">
          <text class="label-icon">ğŸ’°</text>
          <text class="label-text">æ”¶è´¹é€æ˜åº¦</text>
        </view>
        <view class="rating-stars">
          <block wx:for="{{[1, 2, 3, 4, 5]}}" wx:key="index">
            <view
              class="star {{ratings.pricingTransparency >= index ? 'active' : ''}} {{ratings.pricingTransparency >= index + 0.5 && ratings.pricingTransparency < index ? 'half' : ''}}"
              bindtap="onRateStar"
              data-field="pricingTransparency"
              data-value="{{index}}"
            >
              <text class="star-icon">â˜…</text>
            </view>
          </block>
        </view>
        <view class="rating-text">{{ratingTexts[ratings.pricingTransparency]}}</view>
      </view>
    </view>

    <!-- å¿«æ·æ ‡ç­¾ -->
    <view class="tags-section">
      <view class="section-title">
        <text class="title-text">æœåŠ¡å°è±¡</text>
        <text class="title-hint">ï¼ˆå¤šé€‰ï¼‰</text>
      </view>
      <view class="tags-container">
        <view
          class="tag-item {{selectedTags.includes('æŠ€æœ¯ä¸“ä¸š') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="æŠ€æœ¯ä¸“ä¸š"
        >ğŸ”§ æŠ€æœ¯ä¸“ä¸š</view>
        <view
          class="tag-item {{selectedTags.includes('æœåŠ¡çƒ­æƒ…') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="æœåŠ¡çƒ­æƒ…"
        >ğŸ˜Š æœåŠ¡çƒ­æƒ…</view>
        <view
          class="tag-item {{selectedTags.includes('å®Œå·¥è¿…é€Ÿ') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="å®Œå·¥è¿…é€Ÿ"
        >âš¡ å®Œå·¥è¿…é€Ÿ</view>
        <view
          class="tag-item {{selectedTags.includes('ä»·æ ¼å…¬é“') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="ä»·æ ¼å…¬é“"
        >ğŸ’° ä»·æ ¼å…¬é“</view>
        <view
          class="tag-item {{selectedTags.includes('ç¯å¢ƒæ•´æ´') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="ç¯å¢ƒæ•´æ´"
        >âœ¨ ç¯å¢ƒæ•´æ´</view>
        <view
          class="tag-item {{selectedTags.includes('å“åº”åŠæ—¶') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="å“åº”åŠæ—¶"
        >ğŸ“ å“åº”åŠæ—¶</view>
        <view
          class="tag-item {{selectedTags.includes('æ”¶è´¹é€æ˜') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="æ”¶è´¹é€æ˜"
        >ğŸ“‹ æ”¶è´¹é€æ˜</view>
        <view
          class="tag-item {{selectedTags.includes('å€¼å¾—ä¿¡èµ–') ? 'active' : ''}}"
          bindtap="onToggleTag"
          data-tag="å€¼å¾—ä¿¡èµ–"
        >â­ å€¼å¾—ä¿¡èµ–</view>
      </view>
    </view>

    <!-- æ–‡å­—è¯„ä»·ï¼ˆå¯é€‰ï¼‰ -->
    <view class="comment-section">
      <view class="section-title">
        <text class="title-text">è¯¦ç»†è¯„ä»·</text>
        <text class="title-hint">ï¼ˆé€‰å¡«ï¼Œæœ€å¤š100å­—ï¼‰</text>
      </view>
      <textarea
        class="comment-input"
        placeholder="è¯´è¯´æ‚¨çš„æœåŠ¡ä½“éªŒï¼Œå¸®åŠ©æˆ‘ä»¬æ”¹è¿›..."
        maxlength="100"
        value="{{comment}}"
        bindinput="onCommentInput"
        auto-height
      ></textarea>
      <view class="char-count">{{comment.length}}/100</view>
    </view>

    <!-- åŒ¿åé€‰é¡¹ -->
    <view class="anonymous-section">
      <view class="anonymous-option" bindtap="toggleAnonymous">
        <view class="checkbox {{anonymous ? 'checked' : ''}}">
          <text class="check-icon" wx:if="{{anonymous}}">âœ“</text>
        </view>
        <text class="anonymous-label">åŒ¿åè¯„ä»·</text>
      </view>
      <view class="anonymous-hint">åŒ¿ååæ‚¨çš„æ˜µç§°å°†éšè—æ˜¾ç¤º</view>
    </view>

    <!-- æäº¤æŒ‰é’® -->
    <view class="submit-section">
      <button class="submit-btn" bindtap="onSubmit">
        <text class="btn-icon">âœ“</text>
        æäº¤è¯„ä»·
      </button>
      <button class="skip-btn" bindtap="onSkip">
        è·³è¿‡
      </button>
    </view>
  </view>
</view>
