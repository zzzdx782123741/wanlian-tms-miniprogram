<!--pages/fleet-vehicles/fleet-vehicles.wxml - è½¦é˜Ÿè½¦è¾†ç®¡ç†é¡µé¢-->
<view class="page">
  <!-- é¡¶éƒ¨æ ‡é¢˜æ  -->
  <view class="header">
    <view class="header-title">è½¦é˜Ÿè½¦è¾†</view>
    <view class="header-subtitle">ç®¡ç†è½¦é˜Ÿçš„æ‰€æœ‰è½¦è¾†</view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-row">
    <view class="stat-card">
      <view class="stat-value">{{stats.total}}</view>
      <view class="stat-label">å…¨éƒ¨è½¦è¾†</view>
    </view>
    <view class="stat-card">
      <view class="stat-value">{{stats.normal}}</view>
      <view class="stat-label">æ­£å¸¸è¿è¡Œ</view>
    </view>
    <view class="stat-card">
      <view class="stat-value">{{stats.repairing}}</view>
      <view class="stat-label">ç»´ä¿®ä¸­</view>
    </view>
  </view>

  <!-- è½¦è¾†åˆ—è¡¨ -->
  <view class="vehicle-list">
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && vehicles.length === 0}}">
      <text class="empty-icon">ğŸš›</text>
      <text class="empty-text">æš‚æ— è½¦è¾†</text>
      <text class="empty-hint">è¯·å…ˆæ·»åŠ è½¦è¾†åˆ°è½¦é˜Ÿ</text>
    </view>

    <!-- è½¦è¾†å¡ç‰‡ -->
    <view
      class="vehicle-card"
      wx:for="{{vehicles}}"
      wx:key="_id"
      bindtap="onVehicleDetail"
      data-vehicle-id="{{item._id}}"
    >
      <!-- è½¦è¾†å¤´éƒ¨ -->
      <view class="vehicle-header">
        <view class="vehicle-plate">{{item.plateNumber}}</view>
        <view class="vehicle-status status-{{item.status}}">
          {{item.statusText}}
        </view>
      </view>

      <!-- è½¦è¾†è¯¦æƒ… -->
      <view class="vehicle-details">
        <view class="detail-row">
          <text class="detail-icon">ğŸš—</text>
          <view class="detail-info">
            <text class="detail-label">å“ç‰Œè½¦å‹</text>
            <text class="detail-value">{{item.brand}} {{item.model}}</text>
          </view>
        </view>

        <view class="detail-row" wx:if="{{item.currentDriverId}}">
          <text class="detail-icon">ğŸ‘¤</text>
          <view class="detail-info">
            <text class="detail-label">å½“å‰å¸æœº</text>
            <text class="detail-value">{{item.currentDriverId.nickname}}</text>
          </view>
        </view>

        <view class="detail-row" wx:if="{{item.currentDriverId && item.currentDriverId.phone}}">
          <text class="detail-icon">ğŸ“</text>
          <view class="detail-info">
            <text class="detail-label">è”ç³»ç”µè¯</text>
            <text class="detail-value">{{item.currentDriverId.phone}}</text>
          </view>
        </view>
      </view>

      <!-- è½¦è¾†æ“ä½œ -->
      <view class="vehicle-actions">
        <button
          class="action-btn"
          bindtap="onViewOrders"
          data-vehicle-id="{{item._id}}"
          catchtap="true"
        >
          <text class="btn-icon">ğŸ“‹</text>
          ç»´ä¿®è®°å½•
        </button>
        <button
          class="action-btn primary"
          bindtap="onCallDriver"
          data-phone="{{item.currentDriverId.phone}}"
          catchtap="true"
          disabled="{{!item.currentDriverId || !item.currentDriverId.phone}}"
        >
          <text class="btn-icon">ğŸ“</text>
          è”ç³»å¸æœº
        </button>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>
